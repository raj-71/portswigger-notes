# Write-up: Exploiting server-side parameter pollution in a REST URL

Lab-Link: <https://portswigger.net/web-security/api-testing/server-side-parameter-pollution/lab-exploiting-server-side-parameter-pollution-in-rest-url>  
Difficulty: EXPERT


## Lab description

![lab_description](img/1.png)

### Goals

- Login as the `administrator`
- Delete the user `carlos`

## Steps

Start Burp Proxy and make sure every request is going through burp proxy and is visible in http history. Manually crawl through the website and look for interesting request in the http history. When we fill forgot password form we get `/static/js/forgotPassword.js` in which can see that in the email we get some password reset token using which can reset the password. So, we have to target this reset token.

![http_history](img/2.png)

![forgot_password_repeater](img/3.png)

If we append encode character `#` to the username we get error `invalid route` which shows this username is internally used in a url.

![hash_append_username](img/4.png)

We can again verify this using `?` which is used in URLs to add parameters to the url.

![question_append_username](img/5.png)

If we change the username to `./administrator` we get the actual response.

![traversal1](img/6.png)

And we change the username to `../administrator` we get error `invalid route`.

![tarversal2](img/7.png)

Basically we are attempting to traverse the url in hope of finding something. And we get an internal Error on `../../../../administrator`. So we have reached some root of the API.

![traversal3](img/8.png)

We find an interesting API `/api/internal/v1/users/{username}/field/{field}` in `openapi.json` at `../../../../openapi.json#`. `Openapi.json` file contains api documentation of an API. Popular Swagger for API documentation was formerly called OpenAPI.

![api_documentation](img/9.png)

Since, we are already at the `/{usename}` we will change the username value to `/administrator/field/passwordResetToken%23`. We are targeting the passwordResetToken. But we get the error that the API only supports the email field for security reasons.

![field_response_error](img/10.png)

The current API could be the lastest so we will target the older version `v1` and change the username value to `../../v1/users/administrator/field/passwordResetToken%23` and we get the reset token in the response.

![field_response_success](img/11.png)

Now, we just visit the url which we found in the `forgot-password.js` `/forgot-password?passwordResetToken={value}`. Here we can just change the password of the `administrator`. 

![reset_password](img/12.png)

Easy part is left now, to just login as `administrator` and delete the user `carlos`.

![login_administrator](img/13.png)

![delete_carlos](img/14.png)

Hence, lab is solved.

![success](img/15.png)
