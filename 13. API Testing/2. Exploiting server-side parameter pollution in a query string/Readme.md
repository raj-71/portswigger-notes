# Write-up: Exploiting server-side parameter pollution in a query string

Lab-Link: <https://portswigger.net/web-security/api-testing/server-side-parameter-pollution/lab-exploiting-server-side-parameter-pollution-in-query-string>  
Difficulty: PRACTITIONER  
  

## Lab description

![lab_description](img/1.png)

### Goals

- Login as the `administrator`
- Delete user `carlos`

## Steps

While going through the website we can see the forgot password page. When we enter `administrator` we get response that email has been sent to the user's email address. 

![forgot_password_form](img/2.png)

![forgot_password_response](img/3.png)

In the burp proxy history, we find a static js file `/static/js/forgotPassword.js` and inside this we can see a request `/forgot-password?reset_token=${resetToken}`. Now, we need to exfiltrate the reset token for `administrator`

![forgot_password_static_js_file](img/4.png)

We also captured the `POST` request for `forgot-password` in proxy history.

![login_page](img/5.png)

If we change the username parameter, we get invalid username as response.

![image](img/6.png)

And now, we append `&param=random` basically a random paramater with encoded `&` we get response that the parameter `param` is not supported. Which means that our paramater is being checked by the application.

![image](img/7.png)

Removing above if we append encoded `#` which comments out the later, we get response that `field` is not specified. Meaning that a field value is used by the application.

![image](img/8.png)

Now, we if we change the username paramter value to `administrator&field=random#` with encoded key characters. Since, i don't know the field value i put in random. We get response that the invalid field is put in which was kinda expected.

![image](img/9.png)

But, earlier in the static js file we found out that `reset_token` variable if used, we use that as field value we get the successful response with reset_token value for administrator user.

![reset_token](img/10.png)

When, we use the js file user and the reset_token with it and go to url `/forgot-password/?reset_token=value` we can change the administrator password. And then use that to login as `administrator`.

![change_password](img/11.png)
![login_administrator](img/12.png)

Now, we delete the user `carlos`.

![login_administrator](img/13.png)

Hence, lab is solved achieving both of our goals.

![success](img/14.png)
